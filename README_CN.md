# 自定义清单验证系统

## 1. 流程概述 🌟

### 1.1 数据验证工作流的关键阶段

1. **🌱 开始** - 启动验证工作流
2. **📥 加载文件** - 导入三个关键文档：
   - Checklist文档（主数据文件）
   - 进口发票（运输清单）
   - 关税率汇总文件（海关税率表）

3. **🔄 标准化检查** - 确定是否需要数据标准化：
   - **🔧 标准化Checklist文档**（如需要）
   - **📦 标准化进口发票**（如需要）

4. **✅ 核心验证** - 交叉引用数据：
  - 三方数据对比：
    1. Checklist文档（主数据）包含字段：P/N, Desc, HSN, Duty, Welfare, IGST, Cus AIDC, Qty, Price, Category, Item#, TxtLine, Cus Notn, Value Amt
    2. 进口发票数据
    3. 关税率汇总数据
  - 验证步骤：
    a) **物料号匹配**：检查Checklist的P/N需与发票的P/N匹配（无P/N条目可忽略）
    b) **描述检查**：比对前需统一特殊字符格式
    c) **数量验证**：检查Checklist的Qty需与发票的Quantity PCS一致
    d) **价格容差**：允许±1.1%的单位价格差异
    e) **税率核查**：确保HSN编码匹配关税率汇总文件并验证：
       - Duty vs 最终BCD
       - Welfare vs 最终SWS
       - IGST vs 最终IGST
       - Cus AIDC vs 最终AIDC
    f) **新材料处理**：未识别物料添加至关税率汇总文件底部并标记为'新增条目'

5. **❓ 验证结果** - 评估结果：
   - **✔ 成功** → 生成合规报告
   - **❌ 发现错误** → 记录问题 → 生成错误报告

6. **🏁 完成** - 完成验证过程

### 1.2 基础流程摘要
```mermaid
flowchart LR
    A[开始] --> B[加载文件] --> C{需要标准化?}
    C -->|是| D[标准化Checking List] & E[标准化进口发票]
    C -->|否| F[验证]
    D & E --> F --> G{有效?}
    G -->|是| H[报告]
    G -->|否| I[记录错误] --> H
    H --> J[结束]
```

### 1.3 详细流程说明

#### 1.3.1 标准化流程
```mermaid
flowchart TD
    A[开始标准化] --> B[检查文件格式]
    B --> C{Excel格式有效?}
    C -->|否| D[记录格式错误]
    C -->|是| E[读取Excel内容]
    
    E --> F[清理列名]
    F --> G[移除特殊字符]
    F --> H[统一大小写]
    F --> I[移除空白]
    
    E --> J[处理数据行]
    J --> K[移除空行]
    J --> L[清理单元格值]
    J --> M[转换数据类型]
    
    K & L & M --> N[验证必填字段]
    G & H & I --> N
    
    N --> O{所有字段有效?}
    O -->|否| P[记录字段错误]
    O -->|是| Q[保存标准化文件]
    
    P --> R[错误结束]
    Q --> S[成功完成]
```

#### 1.3.2 验证流程
```mermaid
flowchart TD
    A[开始验证] --> B[加载标准化文件]
    B --> C[三方数据对比]
    C --> D[Checking List文档]
    C --> E[进口发票]
    C --> F[税率清单表]
    
    D --> G[物料号匹配]
    E --> G
    G --> H{编号匹配?}
    H -->|否| I[记录异常：缺少P/N]
    H -->|是| J[描述标准化]
    
    J --> K[移除特殊字符]
    J --> L[统一大小写]
    K & L --> M[比对描述]
    
    G --> N[数量验证]
    N --> O{±1.1% 容差?}
    O -->|否| P[记录数量不符]
    
    G --> Q[价格验证]
    Q --> R{±1.1% 容差?}
    R -->|否| S[记录价格偏差]
    
    G --> T[新材料检查]
    T --> U{已识别?}
    U -->|否| V[注册到税率表]
    V --> W[标记为'新增']
    
    O & R & U -->|全部有效| X[生成合规报告]
    I & P & S --> Y[编制错误报告]
    
    G --> H[检查数量]
    G --> I[检查价格]
    G --> J[检查描述]
    
    H --> K{数量有效?}
    I --> L{价格有效?}
    J --> M{描述匹配?}
    
    K -->|否| N[记录数量错误]
    L -->|否| O[记录价格错误]
    M -->|否| P[记录描述错误]
    
    K & L & M -->|是| Q[检查关税率]
    Q --> R{关税率有效?}
    R -->|否| S[记录关税错误]
    R -->|是| T[验证通过]
    
    N & O & P & S --> U[编制错误报告]
    T --> V[生成成功报告]
    
    U & V --> W[结束验证]
```

> **注意：** 这个精简的流程确保了数据一致性和合规性，同时通过全面的报告维护清晰的审计跟踪。
